#toolchain:
#  arch: ""
#  bin: ""
#  host: ""
#  cross_prefix: ""
#  extra_programs: []

packages:
  - name: linux-headers
    url: http://dl-cdn.alpinelinux.org/alpine/edge/main/${PKGS_ARCH}/linux-headers-6.16.10-r0.apk
    build: |
      # Alpine .apk files are tar.gz archives - extract in parent dir
      cd .. && tar -xzf linux-headers-6.16.10-r0.apk
    install: |
      # Copy headers to sysroot (apk extracts to usr/include)
      mkdir -p $SYS_ROOT/usr/include
      cd .. && if [ -d usr/include ]; then
        cp -r usr/include/* $SYS_ROOT/usr/include/
      fi

  - name: zlib
    url: https://zlib.net/zlib-1.3.1.tar.gz
    build: |
      CFLAGS="-fPIC $CFLAGS" ./configure --prefix=/usr --static
      make AR="$AR rc" ARFLAGS=""
    install: |
      make install DESTDIR=$SYS_ROOT AR="$AR rc" ARFLAGS=""

  - name: brotli
    url: https://github.com/google/brotli/archive/refs/tags/v1.1.0.tar.gz
    build: |
      cmake -B build -S . \
        -DCMAKE_SYSTEM_NAME=Linux \
        -DCMAKE_C_COMPILER="$CC" \
        -DCMAKE_AR="$AR" \
        -DCMAKE_RANLIB="$RANLIB" \
        -DCMAKE_FIND_ROOT_PATH="$SYS_ROOT" \
        -DCMAKE_FIND_ROOT_PATH_MODE_PROGRAM=NEVER \
        -DCMAKE_FIND_ROOT_PATH_MODE_LIBRARY=ONLY \
        -DCMAKE_FIND_ROOT_PATH_MODE_INCLUDE=ONLY \
        -DCMAKE_INSTALL_PREFIX=/usr \
        -DCMAKE_BUILD_TYPE=Release \
        -DCMAKE_POSITION_INDEPENDENT_CODE=ON \
        -DBUILD_SHARED_LIBS=OFF
      cmake --build build
    install: |
      cmake --install build --prefix "$SYS_ROOT/usr"

  - name: openssl
    url: https://github.com/openssl/openssl/releases/download/openssl-3.6.0/openssl-3.6.0.tar.gz
    build: |
      ./Configure linux-x86_64 \
        --prefix=/usr \
        --openssldir=/etc/ssl \
        --with-zlib-include=${SYS_ROOT}/usr/include \
        --with-zlib-lib=${SYS_ROOT}/usr/lib \
        --with-brotli-include=${SYS_ROOT}/usr/include \
        --with-brotli-lib=${SYS_ROOT}/usr/lib \
        -L${SYS_ROOT}/usr/lib \
        -I${SYS_ROOT}/usr/include \
        no-shared \
        no-deprecated \
        zlib \
        enable-brotli
      make
    install: |
      make install DESTDIR=$SYS_ROOT
    depends_on:
      - linux-headers
      - zlib
      - brotli

  - name: curl
    url: https://curl.se/download/curl-8.5.0.tar.gz
    build: |
      ./configure --host=${PKGS_HOST} --with-sysroot=${SYS_ROOT} --prefix=/usr \
        --enable-static --disable-shared \
        --with-zlib --with-openssl \
        --without-libpsl --without-libidn2 --disable-ldap --disable-rtsp --disable-manual
      make curl_LDFLAGS="-all-static"
    install: |
      make install DESTDIR=$SYS_ROOT
    depends_on:
      - brotli
      - linux-headers
      - openssl
      - zlib
